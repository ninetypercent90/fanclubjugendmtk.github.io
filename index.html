<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fanclub Bierz√§hler</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    text-align: center;
    color: #fff;
    background: #11491f url('https://upload.wikimedia.org/wikipedia/commons/6/6b/Soccer_pitch_blank.svg') center/cover no-repeat;
  }
  body::before {
    content: "";
    position: fixed;
    top: 50%;
    left: 50%;
    width: 300px;
    height: 300px;
    background: url('https://upload.wikimedia.org/wikipedia/commons/5/5d/1._FC_N√ºrnberg_logo_white.svg') center/contain no-repeat;
    opacity: 0.15;
    transform: translate(-50%,-50%);
    z-index: 0;
  }
  main { position: relative; z-index: 1; padding: 30px; }
  header img { width:120px; }
  h1 { text-shadow: 2px 2px 6px #000; }
  form, ul, table { margin: 20px auto; }
  input, button {
    font-size: 18px;
    padding: 8px 12px;
    margin: 5px;
    border-radius: 6px;
    border: none;
  }
  button { cursor: pointer; background: #006400; color: #fff; }
  ul { list-style: none; padding: 0; }
  li { padding: 6px; background: rgba(0,0,0,0.4); margin:4px auto; width:220px; border-radius:8px; cursor:pointer;}
  #counterArea button { font-size: 24px; padding: 10px 20px; margin:10px;}
  #counter { font-size: 60px; margin:10px; background:rgba(0,0,0,0.5); display:inline-block; padding:10px 40px; border-radius:12px;}
  table { border-collapse: collapse; background:rgba(0,0,0,0.5);}
  th,td { padding:6px 12px; border-bottom:1px solid #333;}
</style>
</head>
<body>
<main>
  <header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/5d/1._FC_N√ºrnberg_logo_white.svg" alt="Logo" />
    <h1>üç∫ Fanclub Bierz√§hler üç∫</h1>
  </header>

  <form id="addGroupForm">
    <input name="groupname" placeholder="Neue Gruppe ‚Ä¶" required />
    <button>Erstellen</button>
  </form>

  <ul id="groupList"></ul>

  <div id="counterArea" style="display:none">
    <h2 id="groupTitle"></h2>
    <div id="counter">0</div><br/>
    <button id="plus">+1</button>
    <button id="minus">‚Äì1</button>
    <button id="reset">Reset</button>
  </div>

  <h2>Gesamtstatistik</h2>
  <table id="totalTable"></table>

  <button id="masterReset" style="margin-top:25px;background:#880000;">Alles zur√ºcksetzen (Admin)</button>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// üëâ Trage hier deine eigenen Firebase-Daten ein:
const firebaseConfig = {
  apiKey: "AIzaSyBM7AlrSKiqZgyiza0CrrQSTowmAw_3SyY",
  databaseURL: "https://fanclub-biercounter-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "fanclub-biercounter"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ---- Benutzername festlegen ----
let username = localStorage.getItem("username");
if (!username) {
  username = prompt("Wie hei√üt du?");
  localStorage.setItem("username", username);
}
const isAdmin = (username.toLowerCase() === "marvin" || username.toLowerCase() === "admin");

// ---- DOM-Elemente ----
const groupList = document.getElementById("groupList");
const addGroupForm = document.getElementById("addGroupForm");
const totalTable = document.getElementById("totalTable");
const masterResetBtn = document.getElementById("masterReset");
masterResetBtn.style.display = isAdmin ? "inline-block" : "none";

// ---- Gruppen live anzeigen ----
onValue(ref(db, "groups"), snap => {
  const data = snap.val() || {};
  groupList.innerHTML = "";
  totalTable.innerHTML = "<tr><th>Name</th><th>Gesamt</th></tr>";
  const totals = {};
  for (const [gname, members] of Object.entries(data)) {
    const li = document.createElement("li");
    const sum = Object.values(members).reduce((s,v)=>s+(v.count||0),0);
    li.textContent = `${gname} (${sum} Bier)`;
    li.onclick = ()=>openGroup(gname);
    groupList.appendChild(li);
    for (const [member,obj] of Object.entries(members)) {
      totals[member]=(totals[member]||0)+(obj.count||0);
    }
  }
  for (const [n,sum] of Object.entries(totals)) {
    const row=document.createElement("tr");
    row.innerHTML=`<td>${n}</td><td>${sum}</td>`;
    totalTable.appendChild(row);
  }
});

// ---- Neue Gruppe anlegen ----
addGroupForm.onsubmit = e => {
  e.preventDefault();
  const name = e.target.groupname.value.trim();
  if (!name) return;
  set(ref(db, "groups/"+name), {});
  e.target.reset();
};

// ---- Gruppe √∂ffnen & z√§hlen ----
function openGroup(gname){
  const userRef = ref(db,"groups/"+gname+"/"+username);
  onValue(userRef,snap=>{
    document.getElementById("counter").textContent=(snap.val()?.count)||0;
  });
  document.getElementById("counterArea").style.display="block";
  document.getElementById("groupTitle").textContent=gname;
  document.getElementById("plus").onclick=()=>changeCount(userRef,1);
  document.getElementById("minus").onclick=()=>changeCount(userRef,-1);
  document.getElementById("reset").onclick=()=>set(userRef,{count:0});
}

function changeCount(refUser,delta){
  onValue(refUser,snap=>{
    const val=(snap.val()?.count||0)+delta;
    if(val>=0) update(refUser,{count:val});
  },{onlyOnce:true});
}

// ---- Gesamten Datensatz l√∂schen (nur Admin) ----
masterResetBtn.onclick = ()=>{
  if(!isAdmin){ alert("Nur der Admin darf das!"); return; }
  if(confirm("Wirklich ALLES l√∂schen?")) remove(ref(db,"groups"));
};
</script>
</body>
</html>
